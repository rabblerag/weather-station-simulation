<!DOCTYPE html>
<html>


<head>
<style>
.table_component {
    overflow: auto;
    width: 100%;
}

.table_component table {
    border: 1px solid #dededf;
    height: 100%;
    width: 100%;
    table-layout: auto;
    border-collapse: collapse;
    border-spacing: 1px;
    text-align: center;
}

.table_component caption {
    caption-side: top;
    text-align: center;
}

.table_component th {
    border: 1px solid #dededf;
    background-color: #eceff1;
    color: #000000;
    padding: 5px;
}

.table_component td {
    border: 1px solid #dededf;
    background-color: #ffffff;
    color: #000000;
    padding: 5px;
}
</style>
<title>Weather metrics</title>
</head>
<body>

<form method="GET" id="get_data">
    <label>Stations:
        <fieldset name="station_id[]" id="station_id[]">
            {% for station in stations %}
                <input type="checkbox" value='{{ station }}' id="{{ station }}" name="station_id[]" {% if station in request.args.getlist("station_id[]") %}checked{% endif %}>
                <label for="{{ station }}">{{ station.replace("_", " ").capitalize() }}</label>
            {% endfor %}
        </fieldset>
    </label>
    <label>Metrics:
        <fieldset name="metrics[]" id="metrics[]">
            <input type="checkbox" value="temperature" id="temperature" name="metrics[]" {% if 'temperature' in request.args.getlist('metrics[]') %}checked{% endif %}>
            <label for="temperature">Temperature</label>

            <input type="checkbox" value="humidity" id="humidity" name="metrics[]" {% if 'humidity' in request.args.getlist('metrics[]') %}checked{% endif %}>
            <label for="humidity">Humidity</label>  

            <input type="checkbox" value="wind_speed" id="wind_speed" name="metrics[]" {% if 'wind_speed' in request.args.getlist('metrics[]') %}checked{% endif %}>
            <label for="wind_speed">Wind speed</label>

        </fieldset>
    </label>
    <label>Timespan:
        <fieldset>
            <label>Start:</label>
            <input type="datetime-local" name="start" step="1" min="2026-01-16T00:00:00" value="{{ start_time }}">

            <label>End:</label>
            <input type="datetime-local" name="end" step="1" min="2026-01-16T00:00:00" value="{{ end_time }}">
        </fieldset>
    </label>    
</form>
<form action="/" id="clear_data"></form>


{% set query_params = request.args.to_dict(flat=False).copy() %}
{% if query_params.pop('page', None) is none %}
{% endif %}
{% set query_string = url_for('index', **query_params) %}

<div style="display: block; padding: 10px; background: #f5f5f5; border-radius: 8px; margin: auto; width: 28%">

    {% if page != 0 %}
        <a href="{{ query_string }}&page={{ page-1 }}" 
            style="display: inline-block; padding: 10px 15px; margin: 0 5px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
            ← Previous
        </a>
    {% else %}
        <button disabled style="padding: 10px 15px; margin: 0 5px; background: #ccc; color: #666; border: none; border-radius: 5px;">
            ← Previous
        </button>
    {% endif %}

    <button type="submit" form="get_data" style="display: inline-block; padding: 10px 15px; margin: 0 5px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">Search</button>
    <button type="submit" form="clear_data" style="display: inline-block; padding: 10px 15px; margin: 0 5px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">Clear</button>
    
    {% if (page+1) < (all_data/per_page)|round(0, "ceil")|int %}
        <a href="{{ query_string }}&page={{ page+1 }}" 
            style="display: inline-block; padding: 10px 15px; margin: 0 5px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
            Next →
        </a>
    {% else %}
        <button disabled style="padding: 10px 15px; margin: 0 5px; background: #ccc; color: #666; border: none; border-radius: 5px;">
            Next →
        </button>
    {% endif %}
</div>

<div class="table_component" role="region" tabindex="0">
<table>
    <caption>Measured data (Page {{ page+1 }} of {{ (all_data/per_page)|round(0, "ceil")|int }})</caption>
    <thead>
        <tr>
            <th>#</th>
            <th>Station</th>
            <th>Timestamp</th>
            {% if "temperature" in selected_metrics %}
                <th>Temperature (°C)</th>
            {% endif %}
            {% if "humidity" in selected_metrics %}
                <th>Humidity (%)</th>
            {% endif %}
            {% if "wind_speed" in selected_metrics %}
                <th>Wind speed (km/h)</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for  metric in metrics %}
        <tr>
            <td style="font-weight: bold;">
                {{ loop.index + page*per_page }}
            </td>
            <td>
                {{ metric.station_id.replace("_", " ").capitalize() }}
            </td>
            <td>
                {{ metric.timestamp }}
            </td>

            {% if "temperature" in selected_metrics %}
                <td>
                    {{ metric.data.get("temperature", "-") }}
                </td>
            {% endif %}

            {% if "humidity" in selected_metrics %}
                <td>
                    {% set humidity = metric.data.get("humidity", "-") %}
                    {% if humidity == "-" %}
                        {{ humidity }}
                    {% else %}
                        {{ (humidity*100)|int }}
                    {% endif %}
                </td>
            {% endif %}
            
            {% if "wind_speed" in selected_metrics %}    
                <td>
                    {{ metric.data.get("wind_speed", "-") }}
                </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<div style="display: block; padding: 10px; background: #f5f5f5; border-radius: 8px; margin: auto; width: 15.5%">

    {% if page != 0 %}
        <a href="{{ query_string }}&page={{ page-1 }}" 
            style="display: inline-block; padding: 10px 15px; margin: 0 5px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
            ← Previous
        </a>
    {% else %}
        <button disabled style="padding: 10px 15px; margin: 0 5px; background: #ccc; color: #666; border: none; border-radius: 5px;">
            ← Previous
        </button>
    {% endif %}

    {% if (page+1) < (all_data/per_page)|round(0, "ceil")|int %}
        <a href="{{ query_string }}&page={{ page+1 }}" 
            style="display: inline-block; padding: 10px 15px; margin: 0 5px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
            Next →
        </a>
    {% else %}
        <button disabled style="padding: 10px 15px; margin: 0 5px; background: #ccc; color: #666; border: none; border-radius: 5px;">
            Next →
        </button>
    {% endif %}
</div>

<p style="margin-top: 10px; color: #666;">
    Page {{ page+1 }} of {{ (all_data/per_page)|round(0, "ceil")|int }} ({{ all_data }} total measurements)
</p>
</div>

</body>
</html>
